// https://github.com/polymerEl/d3-bundle-element v2.0.1 Copyright 2019 Christophe Geiser
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(r.topojson=r.topojson||{})}(this,function(r){"use strict";function n(r){return r}function e(r){if(null==r)return n;var e,t,o=r.scale[0],a=r.scale[1],i=r.translate[0],c=r.translate[1];return function(r,n){n||(e=t=0);var u=2,f=r.length,s=new Array(f);for(s[0]=(e+=r[0])*o+i,s[1]=(t+=r[1])*a+c;u<f;)s[u]=r[u],++u;return s}}function t(r){var n,t=e(r.transform),o=1/0,a=o,i=-o,c=-o;function u(r){(r=t(r))[0]<o&&(o=r[0]),r[0]>i&&(i=r[0]),r[1]<a&&(a=r[1]),r[1]>c&&(c=r[1])}function f(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(f);break;case"Point":u(r.coordinates);break;case"MultiPoint":r.coordinates.forEach(u)}}for(n in r.arcs.forEach(function(r){for(var n,e=-1,u=r.length;++e<u;)(n=t(r[e],e))[0]<o&&(o=n[0]),n[0]>i&&(i=n[0]),n[1]<a&&(a=n[1]),n[1]>c&&(c=n[1])}),r.objects)f(r.objects[n]);return[o,a,i,c]}function o(r,n){return"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map(function(n){return a(r,n)})}:a(r,n)}function a(r,n){var e=n.id,t=n.bbox,o=null==n.properties?{}:n.properties,a=i(r,n);return null==e&&null==t?{type:"Feature",properties:o,geometry:a}:null==t?{type:"Feature",id:e,properties:o,geometry:a}:{type:"Feature",id:e,bbox:t,properties:o,geometry:a}}function i(r,n){var t=e(r.transform),o=r.arcs;function a(r,n){n.length&&n.pop();for(var e=o[r<0?~r:r],a=0,i=e.length;a<i;++a)n.push(t(e[a],a));r<0&&function(r,n){for(var e,t=r.length,o=t-n;o<--t;)e=r[o],r[o++]=r[t],r[t]=e}(n,i)}function i(r){return t(r)}function c(r){for(var n=[],e=0,t=r.length;e<t;++e)a(r[e],n);return n.length<2&&n.push(n[0]),n}function u(r){for(var n=c(r);n.length<4;)n.push(n[0]);return n}function f(r){return r.map(u)}return function r(n){var e,t=n.type;switch(t){case"GeometryCollection":return{type:t,geometries:n.geometries.map(r)};case"Point":e=i(n.coordinates);break;case"MultiPoint":e=n.coordinates.map(i);break;case"LineString":e=c(n.arcs);break;case"MultiLineString":e=n.arcs.map(c);break;case"Polygon":e=f(n.arcs);break;case"MultiPolygon":e=n.arcs.map(f);break;default:return null}return{type:t,coordinates:e}}(n)}function c(r,n){var e={},t={},o={},a=[],i=-1;function c(r,n){for(var t in r){var o=r[t];delete n[o.start],delete o.start,delete o.end,o.forEach(function(r){e[r<0?~r:r]=1}),a.push(o)}}return n.forEach(function(e,t){var o,a=r.arcs[e<0?~e:e];a.length<3&&!a[1][0]&&!a[1][1]&&(o=n[++i],n[i]=e,n[t]=o)}),n.forEach(function(n){var e,a,i=function(n){var e,t=r.arcs[n<0?~n:n],o=t[0];r.transform?(e=[0,0],t.forEach(function(r){e[0]+=r[0],e[1]+=r[1]})):e=t[t.length-1];return n<0?[e,o]:[o,e]}(n),c=i[0],u=i[1];if(e=o[c])if(delete o[e.end],e.push(n),e.end=u,a=t[u]){delete t[a.start];var f=a===e?e:e.concat(a);t[f.start=e.start]=o[f.end=a.end]=f}else t[e.start]=o[e.end]=e;else if(e=t[u])if(delete t[e.start],e.unshift(n),e.start=c,a=o[c]){delete o[a.end];var s=a===e?e:a.concat(e);t[s.start=a.start]=o[s.end=e.end]=s}else t[e.start]=o[e.end]=e;else t[(e=[n]).start=c]=o[e.end=u]=e}),c(o,t),c(t,o),n.forEach(function(r){e[r<0?~r:r]||a.push([r])}),a}function u(r,n,e){var t,o,a;if(arguments.length>1)t=function(r,n,e){var t,o=[],a=[];function i(r){var n=r<0?~r:r;(a[n]||(a[n]=[])).push({i:r,g:t})}function c(r){r.forEach(i)}function u(r){r.forEach(c)}return function r(n){switch(t=n,n.type){case"GeometryCollection":n.geometries.forEach(r);break;case"LineString":c(n.arcs);break;case"MultiLineString":case"Polygon":u(n.arcs);break;case"MultiPolygon":n.arcs.forEach(u)}}(n),a.forEach(null==e?function(r){o.push(r[0].i)}:function(r){e(r[0].g,r[r.length-1].g)&&o.push(r[0].i)}),o}(0,n,e);else for(o=0,t=new Array(a=r.arcs.length);o<a;++o)t[o]=o;return{type:"MultiLineString",arcs:c(r,t)}}function f(r,n){var e={},t=[],o=[];function a(r){r.forEach(function(n){n.forEach(function(n){(e[n=n<0?~n:n]||(e[n]=[])).push(r)})}),t.push(r)}function u(n){return function(r){for(var n,e=-1,t=r.length,o=r[t-1],a=0;++e<t;)n=o,o=r[e],a+=n[0]*o[1]-n[1]*o[0];return Math.abs(a)}(i(r,{type:"Polygon",arcs:[n]}).coordinates[0])}return n.forEach(function r(n){switch(n.type){case"GeometryCollection":n.geometries.forEach(r);break;case"Polygon":a(n.arcs);break;case"MultiPolygon":n.arcs.forEach(a)}}),t.forEach(function(r){if(!r._){var n=[],t=[r];for(r._=1,o.push(n);r=t.pop();)n.push(r),r.forEach(function(r){r.forEach(function(r){e[r<0?~r:r].forEach(function(r){r._||(r._=1,t.push(r))})})})}}),t.forEach(function(r){delete r._}),{type:"MultiPolygon",arcs:o.map(function(n){var t,o=[];if(n.forEach(function(r){r.forEach(function(r){r.forEach(function(r){e[r<0?~r:r].length<2&&o.push(r)})})}),(t=(o=c(r,o)).length)>1)for(var a,i,f=1,s=u(o[0]);f<t;++f)(a=u(o[f]))>s&&(i=o[0],o[0]=o[f],o[f]=i,s=a);return o})}}function s(r,n){for(var e=0,t=r.length;e<t;){var o=e+t>>>1;r[o]<n?e=o+1:t=o}return e}function l(r){if(null==r)return n;var e,t,o=r.scale[0],a=r.scale[1],i=r.translate[0],c=r.translate[1];return function(r,n){n||(e=t=0);var u=2,f=r.length,s=new Array(f),l=Math.round((r[0]-i)/o),p=Math.round((r[1]-c)/a);for(s[0]=l-e,e=l,s[1]=p-t,t=p;u<f;)s[u]=r[u],++u;return s}}function p(){return!0}function h(r){return r}function g(r){return null!=r.type}function y(r){var n,e=new Array(r.arcs.length),t=0;function o(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(o);break;case"Polygon":a(r.arcs);break;case"MultiPolygon":r.arcs.forEach(a)}}function a(r){for(var n=0,o=r.length;n<o;++n,++t)for(var a=r[n],i=0,c=a.length;i<c;++i){var u=a[i];u<0&&(u=~u);var f=e[u];null==f?e[u]=t:f!==t&&(e[u]=-1)}}for(n in r.objects)o(r.objects[n]);return function(r){for(var n,t=0,o=r.length;t<o;++t)if(-1===e[(n=r[t])<0?~n:n])return!0;return!1}}function b(r){var n=r[0],e=r[1],t=r[2];return Math.abs((n[0]-t[0])*(e[1]-n[1])-(n[0]-e[0])*(t[1]-n[1]))/2}function m(r){for(var n,e=-1,t=r.length,o=r[t-1],a=0;++e<t;)n=o,o=r[e],a+=n[0]*o[1]-n[1]*o[0];return Math.abs(a)/2}function v(r,n,e){return n=null==n?Number.MIN_VALUE:+n,null==e&&(e=m),function(t,a){return e(o(r,{type:"Polygon",arcs:[t]}).geometry.coordinates[0],a)>=n}}function d(r,n){return r[1][2]-n[1][2]}function E(r){return[r[0],r[1],0]}function M(r,n){return n-r}var P=Math.PI,k=2*P,x=P/4,w=P/180,j=Math.abs,A=Math.atan2,_=Math.cos,C=Math.sin;function L(r,n){for(var e,t,o=0,a=r.length,i=0,c=r[n?o++:a-1],u=c[0]*w,f=c[1]*w/2+x,s=_(f),l=C(f);o<a;++o){e=u,u=(c=r[o])[0]*w,f=c[1]*w/2+x,t=s,s=_(f);var p=u-e,h=p>=0?1:-1,g=h*p,y=l*(l=C(f)),b=t*s+y*_(g),m=y*h*C(g);i+=A(m,b)}return i}r.bbox=t,r.feature=o,r.mesh=function(r){return i(r,u.apply(this,arguments))},r.meshArcs=u,r.merge=function(r){return i(r,f.apply(this,arguments))},r.mergeArcs=f,r.neighbors=function(r){var n={},e=r.map(function(){return[]});function t(r,e){r.forEach(function(r){r<0&&(r=~r);var t=n[r];t?t.push(e):n[r]=[e]})}function o(r,n){r.forEach(function(r){t(r,n)})}var a={LineString:t,MultiLineString:o,Polygon:o,MultiPolygon:function(r,n){r.forEach(function(r){o(r,n)})}};for(var i in r.forEach(function r(n,e){"GeometryCollection"===n.type?n.geometries.forEach(function(n){r(n,e)}):n.type in a&&a[n.type](n.arcs,e)}),n)for(var c=n[i],u=c.length,f=0;f<u;++f)for(var l=f+1;l<u;++l){var p,h=c[f],g=c[l];(p=e[h])[i=s(p,g)]!==g&&p.splice(i,0,g),(p=e[g])[i=s(p,h)]!==h&&p.splice(i,0,h)}return e},r.quantize=function(r,n){if(r.transform)throw new Error("already quantized");if(n&&n.scale)u=r.bbox;else{if(!((e=Math.floor(n))>=2))throw new Error("n must be â‰¥2");var e,o=(u=r.bbox||t(r))[0],a=u[1],i=u[2],c=u[3];n={scale:[i-o?(i-o)/(e-1):1,c-a?(c-a)/(e-1):1],translate:[o,a]}}var u,f,s=l(n),p=r.objects,h={};function g(r){return s(r)}function y(r){var n;switch(r.type){case"GeometryCollection":n={type:"GeometryCollection",geometries:r.geometries.map(y)};break;case"Point":n={type:"Point",coordinates:g(r.coordinates)};break;case"MultiPoint":n={type:"MultiPoint",coordinates:r.coordinates.map(g)};break;default:return r}return null!=r.id&&(n.id=r.id),null!=r.bbox&&(n.bbox=r.bbox),null!=r.properties&&(n.properties=r.properties),n}for(f in p)h[f]=y(p[f]);return{type:"Topology",bbox:u,transform:n,objects:h,arcs:r.arcs.map(function(r){var n,e=0,t=1,o=r.length,a=new Array(o);for(a[0]=s(r[0],0);++e<o;)((n=s(r[e],e))[0]||n[1])&&(a[t++]=n);return 1===t&&(a[t++]=[0,0]),a.length=t,a})}},r.transform=e,r.untransform=l,r.filter=function(r,n){var e,t=r.objects,o={};function a(r){var n,e;switch(r.type){case"Polygon":n=(e=i(r.arcs))?{type:"Polygon",arcs:e}:{type:null};break;case"MultiPolygon":n=(e=r.arcs.map(i).filter(h)).length?{type:"MultiPolygon",arcs:e}:{type:null};break;case"GeometryCollection":n=(e=r.geometries.map(a).filter(g)).length?{type:"GeometryCollection",geometries:e}:{type:null};break;default:return r}return null!=r.id&&(n.id=r.id),null!=r.bbox&&(n.bbox=r.bbox),null!=r.properties&&(n.properties=r.properties),n}function i(r){return r.length&&(e=r[0],n(e,!1))?[r[0]].concat(r.slice(1).filter(c)):null;var e}function c(r){return n(r,!0)}for(e in null==n&&(n=p),t)o[e]=a(t[e]);return function(r){var n,e,t=r.objects,o={},a=r.arcs,i=a.length,c=-1,u=new Array(i),f=0,s=-1;function l(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(l);break;case"LineString":h(r.arcs);break;case"MultiLineString":case"Polygon":r.arcs.forEach(h);break;case"MultiPolygon":r.arcs.forEach(g)}}function p(r){r<0&&(r=~r),u[r]||(u[r]=1,++f)}function h(r){r.forEach(p)}function g(r){r.forEach(h)}function y(r){var n;switch(r.type){case"GeometryCollection":n={type:"GeometryCollection",geometries:r.geometries.map(y)};break;case"LineString":n={type:"LineString",arcs:m(r.arcs)};break;case"MultiLineString":n={type:"MultiLineString",arcs:r.arcs.map(m)};break;case"Polygon":n={type:"Polygon",arcs:r.arcs.map(m)};break;case"MultiPolygon":n={type:"MultiPolygon",arcs:r.arcs.map(v)};break;default:return r}return null!=r.id&&(n.id=r.id),null!=r.bbox&&(n.bbox=r.bbox),null!=r.properties&&(n.properties=r.properties),n}function b(r){return r<0?~u[~r]:u[r]}function m(r){return r.map(b)}function v(r){return r.map(m)}for(e in t)l(t[e]);for(n=new Array(f);++c<i;)u[c]&&(u[c]=++s,n[s]=a[c]);for(e in t)o[e]=y(t[e]);return{type:"Topology",bbox:r.bbox,transform:r.transform,objects:o,arcs:n}}({type:"Topology",bbox:r.bbox,transform:r.transform,objects:o,arcs:r.arcs})},r.filterAttached=y,r.filterAttachedWeight=function(r,n,e){var t=y(r),o=v(r,n,e);return function(r,n){return t(r,n)||o(r,n)}},r.filterWeight=v,r.planarRingArea=m,r.planarTriangleArea=b,r.presimplify=function(r,n){var t=r.transform?e(r.transform):E,o=function(){var r={},n=[],e=0;function t(r,e){for(;e>0;){var t=(e+1>>1)-1,o=n[t];if(d(r,o)>=0)break;n[o._=e]=o,n[r._=e=t]=r}}function o(r,t){for(;;){var o=t+1<<1,a=o-1,i=t,c=n[i];if(a<e&&d(n[a],c)<0&&(c=n[i=a]),o<e&&d(n[o],c)<0&&(c=n[i=o]),i===t)break;n[c._=t]=c,n[r._=t=i]=r}}return r.push=function(r){return t(n[r._=e]=r,e++),e},r.pop=function(){if(!(e<=0)){var r,t=n[0];return--e>0&&(r=n[e],o(n[r._=0]=r,0)),t}},r.remove=function(r){var a,i=r._;if(n[i]===r)return i!==--e&&(d(a=n[e],r)<0?t:o)(n[a._=i]=a,i),i},r}();null==n&&(n=b);var a=r.arcs.map(function(r){var e,a,c,u=[],f=0;for(a=1,c=(r=r.map(t)).length-1;a<c;++a)(e=[r[a-1],r[a],r[a+1]])[1][2]=n(e),u.push(e),o.push(e);for(r[0][2]=r[c][2]=1/0,a=0,c=u.length;a<c;++a)(e=u[a]).previous=u[a-1],e.next=u[a+1];for(;e=o.pop();){var s=e.previous,l=e.next;e[1][2]<f?e[1][2]=f:f=e[1][2],s&&(s.next=l,s[2]=e[2],i(s)),l&&(l.previous=s,l[0]=e[0],i(l))}return r});function i(r){o.remove(r),r[1][2]=n(r),o.push(r)}return{type:"Topology",bbox:r.bbox,objects:r.objects,arcs:a}},r.quantile=function(r,n){var e=[];return r.arcs.forEach(function(r){r.forEach(function(r){isFinite(r[2])&&e.push(r[2])})}),e.length&&function(r,n){if(e=r.length){if((n=+n)<=0||e<2)return r[0];if(n>=1)return r[e-1];var e,t=(e-1)*n,o=Math.floor(t),a=r[o],i=r[o+1];return a+(i-a)*(t-o)}}(e.sort(M),n)},r.simplify=function(r,n){n=null==n?Number.MIN_VALUE:+n;var e=r.arcs.map(function(r){for(var e,t=-1,o=0,a=r.length,i=new Array(a);++t<a;)(e=r[t])[2]>=n&&(i[o++]=[e[0],e[1]]);return i.length=o,i});return{type:"Topology",transform:r.transform,bbox:r.bbox,objects:r.objects,arcs:e}},r.sphericalRingArea=function(r,n){var e=L(r,!0);return n&&(e*=-1),2*(e<0?k+e:e)},r.sphericalTriangleArea=function(r){return 2*j(L(r,!1))},Object.defineProperty(r,"__esModule",{value:!0})});
